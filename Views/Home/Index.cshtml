@{
    ViewData["Title"] = "Home Page";
}

<div class="text-center mt-5">
    <h1 class="display-4 mb-4">Stock Signal Bot</h1>
    <p class="text-muted mb-5">Search for a stock to get recommendation</p>

    <div class="d-flex justify-content-center mb-3">
        <div class="position-relative" style="width: 400px;">
            <div class="input-group">
                <input type="text" id="stockSearch" class="form-control" placeholder="Search stocks..."
                    autocomplete="off" />
                <button class="btn btn-primary" id="searchButton">Search</button>
            </div>
            <ul id="suggestions" class="list-group position-absolute w-100 shadow-sm"
                style="z-index: 1000; display: none;"></ul>
        </div>
    </div>

    <div section="results" class="mt-4 hidden">
        <h3 class="stock-name"></h3>
        <p class="stock-value"></p>
    </div>

    <!-- Show stock data here -->
    <div id="stockResult" class="mt-4"></div>
</div>

@section Scripts {
    <script>
        const stockList = ["BIL.N0000", "HNBF.N0000", "SUN.N0000", "JKH.N0000", "LIOC.N0000"];
        const searchInput = document.getElementById("stockSearch");
        const suggestionBox = document.getElementById("suggestions");
        const searchButton = document.getElementById("searchButton");
        const stockResult = document.getElementById("stockResult");

        // Autocomplete
        searchInput.addEventListener("input", function () {
            const query = this.value.toUpperCase().trim();
            suggestionBox.innerHTML = "";

            if (query.length === 0) {
                suggestionBox.style.display = "none";
                return;
            }

            const filtered = stockList.filter(stock => stock.includes(query));
            if (filtered.length === 0) {
                suggestionBox.style.display = "none";
                return;
            }

            filtered.forEach(stock => {
                const li = document.createElement("li");
                li.className = "list-group-item list-group-item-action";
                li.textContent = stock;
                li.addEventListener("click", () => {
                    searchInput.value = stock;
                    suggestionBox.style.display = "none";
                });
                suggestionBox.appendChild(li);
            });

            suggestionBox.style.display = "block";
        });

        // Hide suggestions when clicking outside
        document.addEventListener("click", function (e) {
            if (!searchInput.contains(e.target) && !suggestionBox.contains(e.target)) {
                suggestionBox.style.display = "none";
            }
        });

        // Search button click
        searchButton.addEventListener("click", async () => {
            const symbol = searchInput.value.trim().toUpperCase();
            if (!symbol) {
                alert("Please enter a stock symbol");
                return;
            }

            try {
                const response = await fetch(`/api/stock/${symbol}`);
                if (!response.ok) throw new Error("Stock not found");

                const data = await response.json();

                stockResult.innerHTML = `
                    <h5>Symbol: ${data.symbol}</h5>
                    <p>Current Price: ${data.price}</p>
                    <p>Last Traded Price : ${data.lastTradedPrice}</p>
                `;
            } catch (err) {
                stockResult.innerHTML = `<p class="text-danger">Error: ${err.message}</p>`;
            }
        });
    </script>
}